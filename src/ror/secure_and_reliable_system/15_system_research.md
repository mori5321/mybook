ほとんどのシステムは、いずれはうまく機能しなくなります。

- デバッグのための適切なログ
- 保護とアクセス制御を念頭においてロギングシステムを設計する必要がある

システムの問題の出アッグとセキュリティに関する懸念事項の違い


デバッグめっちゃ好き



デバッグを成功させるための2つの要件
- システムがどのように動作するはずであるかを知る
- システマティックであれ: データを収集し、原因の仮説を建て、理論を検証する


ビットフリップの発生確率は年間で1%未満。
クラウドサービスの運用担当者は、メモリの故障を毎日観測する可能性がある。

ウマとシマウマ
小規模で新しいシステムを扱う場合には、ウマ(一般的なバグ)を想定する
比較的安定したシステムを扱う場合には、シマウマ(まれなバグ)を想定する
    - ウマはすでに直されている可能性が高いため


誤った断定をしてしまうこと あるよな


観察と想定を記録する
- デバッグを開始する時点ではそれが5分で終わるか5ヶ月かかるかはわからない。記録だ維持。
- 別の人に引き継げる・協力依頼できる。
    - 否定的な結果の素晴らしさ from SREサイトリライアビリティ

バグは往々にしてシステムに関する人間のメンタル・モデルと、システムの現実の実装との狭間に潜んでいるものです。

運用過負荷とアラート疲れは盲点を生むことになり、逸脱の状態化を招く。
=> オンコールローテーションや対応チームの人員を適宜入れ替えている。
=> それに伴ってドキュメンテーションを作成したり、システムを他者に説明したりするプロセスも、システムへの理解を深めるために重要です。


バグを再現する。
=> 可能であればプロダクション環境のがオブでバグの再現を試みる。

問題を分離する
=> コードの最小限のサブセットまで分離できれば最高。

相関関係と因果関係に留意する
e.g. なんらかのバグ => レイテンシの増加 => ユーザーリクエストの減少 (バグとリクエスト減少は相関関係があるが、因果関係はない)


実際のデータで仮説をテストする

ドキュメントを読み直す

デバッグが上達するには、デバッグセッション中に自分が書くコードを保存しておくこと。



行き詰まったとき
-> オブザーバビリティを改善する。
-> 休憩を取る
-> コードをクリーンアップする
-> レガシーシステムを削除する
-> 異変の起点で止める(fail open or faile closed => 8章)


共同デバッグ(教育系)
- ノートPCを開くのは2人だけ
　- 操作者(他の人から要求されたアクションを実行する)
　- 記録者(記録する)
- すべてのアクションは同席する参加者によって決定する。コンピューターを操作するのは2人だけだが、この2人は取るべきアクションを決定しない。


説明のつかない矛盾が増えてきた場合は、攻撃者がシステムを改ざんしている可能性がある。
例
- デバッグに必要なログやデータに欠落が見られる
- システムの挙動から調査を始めたが、気がつけばアカウントやユーザーのアクションに関わる仮説を建てている
- システムが偶然では説明できない挙動をしている。例えば、Webサーバーがクラッシュしたように見えながら対話型シェルを生成しつづけている。
- ファイルにそのファイルタイプとしては以上と思われる特徴がある
- ファイルが意図的に隠されている。


プライバシーへの配慮
- ログの深さ
    - ログは可能な限り完全であるべき
- 保持
- データの匿名化や仮名化

SN(Signal to Noise=信号対雑音)比の良いログを重視する。
ストレージをウォームとコールドに分ける。


一元管理されるログ。
