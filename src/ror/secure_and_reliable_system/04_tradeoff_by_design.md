# 4: 設計におけるトレードオフ


信頼性やセキュリティといった非機能要件は多くの場合、特定するのがはるかに難しい。

信頼性やセキュリティは「創発特性」である。
信頼性 ... システム設計や開発・運用体勢から生じる創発特性
セキュリティ ... システムと運用の環境を設計する方法のさまざまな側面から生じる創発特性

## Google の 設計ドキュメントテンプレート(信頼性とセキュリティに関連するセクション)
### スケーラビリティ
- 拡張性はどの程度か? 
    - データサイズの増加
    - トラフィックの増加

### 冗長性と信頼性
- ローカルデータの損失や一過性のエラー(一時的停電など)をシステムが処理する方法と、そうした状況がシステムに及ぼす影響
    - バックアップが必要なシステムやコンポーネントはどれか?
    - どのようにバックアップするか? 
    - リストアはどのように行うか? 
    - データが失われてからリストアされるまでの間になにが起こるか? 
    - 部分的な損失ならばサービスを継続できるか? 
    - 失われた部分のみをバックアップから復元することはできるか

### 依存関係に関する考慮事項
- 他のサービスに対する依存関係が一定時間にわたって利用できない場合にはどうなる? 

### データ完全性
- データストアにおけるデータの破損や損失をどのように見つけますか? 
    - データ損失の原因として検出されるのはなんですか? 
        - ユーザーのエラー
        - アプリケーションのバグ
        - storageのバグ
        - 被災
    - こうした損失にきづくまでどれくらいの時間がかかりますか? 
    - 損失からリカバリするためにどのような計画を建てていますか? 


### SLA要件
- サービスレベル保証を監査・モニタリングするためにどのような仕組みを取り入れていますか? 
- 表明した信頼性をどのように保証できますか? 

### セキュリティとプライバシーに関する考慮事項
Googleのシステムは定常的に攻撃を受けています。この設計に関連する潜在的な攻撃について考え、それがもたらしうる最悪の影響と、個々の攻撃を防止またわ緩和するために取り入れている対策を記述します。

## 要件のバランスの確保
セキュリティと信頼性は創発特性であるため、機能要件と相互に影響し合う傾向がある


セキュリティと信頼性を、これらに関する懸念を当初から念頭において設計されたわけではないシステムに「後付け」することは困難

- 理解しやすいインターフェイスがなく
- 依存関係が複雑に絡み合っているシステム
の場合には、可用性が低下しセキュリティに影響を及ぼすバグが発生しやすくなります。

デプロイ済みのシステムに大幅な変更を急いで行えば追加の欠陥を持ち込み甚大なリスクを避けられない。
ソフトウェアプロジェクトの初期の計画フェーズから検討することが重要です。

> 深刻なセキュリティインシデントのために市場から撤退せざるを得なくなった企業もあります


## ケーススタディ
### サードパーティを利用する機密データ処理
- Pros: 自前で機密データを管理しなくてよい
- Cons: 信頼性リスク
    - 自前のフォールバックで軽減可能
        - しかしそれ自体の障害モードを持ち込む可能性もあり、新たなリスクサーフェスである
- Cons: セキュリティリスク
    - 機密性の高いデータをサードパーティに委託する
        - 軽減方法
            ?: サンドボックス化されたAPI


## 先送り

チームはよく「速度」のために早期の主要な設計要因としてセキュリティや信頼性を無視しがち。

初期速度と持続速度を区別することが重要。
